# Kokoro Android ä¸­æ–‡æ”¯æŒå®æ–½è®¡åˆ’

> ğŸ“… åˆ›å»ºæ—¶é—´: 2025-10-25  
> ğŸ¯ ç›®æ ‡: åœ¨ Android åº”ç”¨ä¸­æ·»åŠ ä¸­æ–‡è¯­éŸ³åˆæˆæ”¯æŒ  
> ğŸ”— é¡¹ç›®åœ°å€: https://github.com/lemonhall/kokoro-ja-demo

---

## ğŸ“‹ æ ¸å¿ƒå‘ç°

é€šè¿‡æµ‹è¯• `zh.py`ï¼Œæˆ‘ä»¬ç¡®è®¤äº†:

âœ… **æ¨¡å‹æ— éœ€æ”¹åŠ¨** - Kokoro-82M æ¨¡å‹æœ¬èº«æ˜¯å¤šè¯­è¨€é€šç”¨çš„  
âœ… **è¯­éŸ³åµŒå…¥å¯å¤ç”¨** - åªéœ€å¯¼å‡º `zf_xiaoxiao` éŸ³è‰²å³å¯  
âœ… **æ ¸å¿ƒå·®å¼‚åœ¨å‰å¤„ç†** - æ—¥è¯­ç”¨å‡åâ†’IPAï¼Œä¸­æ–‡ç”¨æ‹¼éŸ³â†’IPA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¾“å…¥æ–‡æœ¬   â”‚  â†’  â”‚  G2Pè½¬æ¢  â”‚  â†’  â”‚  éŸ³ç´ åºåˆ—    â”‚  â†’  â”‚ è¯­éŸ³æ³¢å½¢â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     æ—¥è¯­                å‡åâ†’IPA           kÊ²oËÎ²a...          åŒä¸€æ¨¡å‹
     ä¸­æ–‡                æ‹¼éŸ³â†’IPA           ni xau...           âœ…
```

---

## ğŸ¯ å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ 0: æ¢ç´¢ä¸å‡†å¤‡ (å½“å‰é˜¶æ®µ)

**ç›®æ ‡**: ç†è§£ä¸­æ–‡ G2P è½¬æ¢çš„å®Œæ•´æµç¨‹

#### Task 0.1: åˆ†æ misaki[zh] çš„å®ç° âœ…
- [x] æŸ¥çœ‹ `.venv/Lib/site-packages/misaki/zh.py` æºç 
- [x] æå–æ‹¼éŸ³â†’IPA çš„æ˜ å°„è§„åˆ™
- [x] ç†è§£å£°æ¯ã€éŸµæ¯ã€å£°è°ƒçš„å¤„ç†é€»è¾‘
- [x] è®°å½•å…³é”®æ•°æ®ç»“æ„

**è¾“å‡º**: âœ… `misakiä¸­æ–‡G2Påˆ†ææŠ¥å‘Š.md`

---

#### Task 0.2: æµ‹è¯• pypinyin çš„æ‹¼éŸ³è½¬æ¢ âœ…
- [x] ç¼–å†™æµ‹è¯•è„šæœ¬ `test_chinese_pinyin.py`
- [x] æµ‹è¯•ä¸åŒç±»å‹çš„ä¸­æ–‡å¥å­:
  - ç®€å•å¥: "ä½ å¥½ä¸–ç•Œ" â†’ `ni3 hao3 shi4 jie4`
  - å¤šéŸ³å­—: "æˆ‘è¡Œè¡Œå¥½å§" â†’ `wo3 xing2 xing2 hao3 ba5`
  - æ•°å­—: "2024å¹´10æœˆ25æ—¥" â†’ ä¿ç•™æ•°å­—
  - æ··åˆ: "iPhone 15 å¾ˆè´µ" â†’ ä¿ç•™è‹±æ–‡
- [x] è®°å½•æ‹¼éŸ³è¾“å‡ºæ ¼å¼

**è¾“å‡º**: âœ… æ‹¼éŸ³è½¬æ¢æµ‹è¯•ç»“æœï¼ˆå·²éªŒè¯ï¼‰

---

#### Task 0.3: å¯¹æ¯” Python ç«¯å®Œæ•´æµç¨‹ âœ…
- [x] è¿è¡Œ `zh.py` å¹¶è®°å½•æ¯ä¸€æ­¥çš„è¾“å‡º:
  ```
  "ä½ å¥½ä¸–ç•Œ" â†’ ni3 hao3 shi4 jie4 â†’ niâ†“xauâ†“ Ê‚É¨â†˜Ê¨jeâ†˜
  "ä¸­æ–‡æµ‹è¯•" â†’ zhong1 wen2 ce4 shi4 â†’ ê­§ÊŠâ†’Å‹wÉ™â†—n Ê¦Ê°É¤â†˜Ê‚É¨â†˜
  ```
- [x] ä¿å­˜å®Œæ•´çš„éŸ³ç´ è¾“å‡ºä½œä¸ºå¯¹ç…§åŸºå‡†
- [x] ç†è§£ jieba åˆ†è¯çš„ä½œç”¨ (ç”¨äºè‹±æ–‡åˆ†å‰²)

**è¾“å‡º**: âœ… Python ç«¯å®Œæ•´è½¬æ¢æ—¥å¿—ï¼ˆtest_chinese_pinyin.pyï¼‰

---

### é˜¶æ®µ 1: å¯¼å‡ºä¸­æ–‡è¯­éŸ³èµ„æº

**ç›®æ ‡**: å‡†å¤‡ Android ç«¯éœ€è¦çš„ä¸­æ–‡éŸ³è‰²åµŒå…¥

#### Task 1.1: ä¿®æ”¹è¯­éŸ³å¯¼å‡ºè„šæœ¬ âœ…
- [x] åˆ›å»º `export_chinese_voices.py` (åŸºäºæ—¥æ–‡ç‰ˆæœ¬)
- [x] ä¿®æ”¹ä¸ºå¯¼å‡º `zf_xiaoxiao` éŸ³è‰²
- [x] ç¡®è®¤åµŒå…¥å‘é‡çš„ç»´åº¦å’Œæ ¼å¼: `[510, 1, 256]` âœ…
- [x] å¯¼å‡ºä¸º `app/src/main/assets/voices/zf_xiaoxiao.bin`
- [x] åŒ…å«å®Œæ•´ 510 å¸§ï¼Œæ”¯æŒåŠ¨æ€å¸§é€‰æ‹©

**è¾“å‡º**: âœ… `zf_xiaoxiao.bin` (510 KB), `zf_xiaoxiao.npy` (510 KB)

---

#### Task 1.2: éªŒè¯è¯­éŸ³åµŒå…¥å¯ç”¨æ€§ âœ…
- [x] Python ç«¯éªŒè¯æˆåŠŸ
- [x] ç¡®è®¤å½¢çŠ¶: `[510, 256]` âœ… (æ³¨æ„: æ˜¯256ç»´ï¼Œä¸æ˜¯512)
- [x] æµ‹è¯•éŸ³é¢‘ç”ŸæˆæˆåŠŸ: `test_xiaoxiao.wav` (3.00ç§’)
- [x] éªŒè¯åŠ¨æ€å¸§é€‰æ‹©: 34ä¸ªéŸ³ç´  â†’ é€‰æ‹©ç¬¬33å¸§ âœ…
- [x] å¸§é—´å·®å¼‚éªŒè¯: é•¿å¥éŸµå¾‹å·®å¼‚æ˜æ˜¾ âœ…

**è¾“å‡º**: âœ… Pythonç«¯å®Œå…¨éªŒè¯é€šè¿‡

---

### é˜¶æ®µ 2: ç§»æ¤ä¸­æ–‡ G2P æ ¸å¿ƒé€»è¾‘

**ç›®æ ‡**: åœ¨ Kotlin ä¸­å®ç°æ‹¼éŸ³â†’IPA è½¬æ¢

#### Task 2.1: åˆ›å»ºæ‹¼éŸ³â†’IPA æ˜ å°„è¡¨
- [ ] åˆ›å»º `ChinesePinyinToIPA.kt`
- [ ] ç§»æ¤ misaki çš„å£°æ¯æ˜ å°„è¡¨ (21ä¸ª)
  ```kotlin
  private val initialsMap = mapOf(
      "b" to "p",    // ä¸é€æ°”æ¸…å¡éŸ³
      "p" to "pÊ°",   // é€æ°”æ¸…å¡éŸ³
      // ... å®Œæ•´æ˜ å°„
  )
  ```
- [ ] ç§»æ¤éŸµæ¯æ˜ å°„è¡¨ (39ä¸ª)
  ```kotlin
  private val finalsMap = mapOf(
      "a" to "a",
      "ai" to "ai",
      "an" to "an",
      "ang" to "aÅ‹",
      // ... å®Œæ•´æ˜ å°„
  )
  ```
- [ ] å®ç°å£°è°ƒå¤„ç†é€»è¾‘

**è¾“å‡º**: `ChinesePinyinToIPA.kt` åŸºç¡€æ¡†æ¶

---

#### Task 2.2: å®ç°æ‹¼éŸ³è§£æç®—æ³•
- [ ] ç¼–å†™æ‹¼éŸ³åˆ‡åˆ†é€»è¾‘ (å£°æ¯+éŸµæ¯)
- [ ] å¤„ç†ç‰¹æ®Šæƒ…å†µ:
  - é›¶å£°æ¯: "an" â†’ "âˆ…an"
  - å„¿åŒ–éŸ³: "haor" â†’ "xauÉš"
  - è½»å£°: "de" â†’ "dÉ™"
- [ ] å‚è€ƒ OpenJTalkG2P çš„å®ç°æ¨¡å¼

**è¾“å‡º**: å®Œæ•´çš„æ‹¼éŸ³è§£æå™¨

---

#### Task 2.3: å•å…ƒæµ‹è¯•
- [ ] åˆ›å»ºæµ‹è¯•ç”¨ä¾‹:
  ```kotlin
  "ni3 hao3" â†’ "ni xau"
  "zhong1 wen2" â†’ "tÊ‚ÊŠÅ‹ wÉ™n"
  ```
- [ ] å¯¹æ¯” Python ç«¯è¾“å‡ºï¼Œç¡®ä¿ä¸€è‡´æ€§
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 90%

**è¾“å‡º**: é€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹

---

### é˜¶æ®µ 3: é›†æˆæ±‰å­—è½¬æ‹¼éŸ³åº“

**ç›®æ ‡**: è®© Android åº”ç”¨èƒ½å¤Ÿè¾“å…¥æ±‰å­—

#### Task 3.1: é€‰æ‹©æ‹¼éŸ³åº“
- [ ] è¯„ä¼° TinyPinyin åº“:
  - ä¼˜ç‚¹: è½»é‡ã€æ— ä¾èµ–ã€å¿«é€Ÿ
  - ç¼ºç‚¹: å¤šéŸ³å­—å‡†ç¡®åº¦ä¸€èˆ¬
- [ ] æ·»åŠ  Gradle ä¾èµ–:
  ```kotlin
  implementation("com.github.promeg:tinypinyin:2.0.3")
  ```
- [ ] æµ‹è¯•åŸºæœ¬åŠŸèƒ½

**å¤‡é€‰æ–¹æ¡ˆ**: å¦‚æœ TinyPinyin ä¸æ»¡è¶³éœ€æ±‚ï¼Œè€ƒè™‘ç§»æ¤ pypinyin çš„è¯å…¸

---

#### Task 3.2: åˆ›å»º ChineseG2PSystem
- [ ] åˆ›å»º `ChineseG2PSystem.kt`ï¼Œå‚è€ƒ `JapaneseG2PSystem.kt` çš„ç»“æ„
- [ ] å®ç°æ ¸å¿ƒæ–¹æ³•:
  ```kotlin
  class ChineseG2PSystem(private val context: Context) {
      fun textToPhonemes(text: String): String {
          // 1. æ±‰å­— â†’ æ‹¼éŸ³ (TinyPinyin)
          // 2. æ‹¼éŸ³ â†’ IPA (ChinesePinyinToIPA)
          // 3. è¿”å›éŸ³ç´ å­—ç¬¦ä¸²
      }
  }
  ```

**è¾“å‡º**: `ChineseG2PSystem.kt`

---

#### Task 3.3: ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æµ‹è¯•å¥å­: "ä¸­æ–‡æµ‹è¯•ï¼Œé•¿å¥æœ—è¯»"
- [ ] å¯¹æ¯” Android è¾“å‡º vs Python è¾“å‡º:
  ```
  Python:  tÊ‚ÊŠÅ‹ wÉ™n tsÊ°É™ Ê‚É¨ tÊ‚aÅ‹ tÉ•y laÅ‹ tu
  Android: tÊ‚ÊŠÅ‹ wÉ™n tsÊ°É™ Ê‚É¨ tÊ‚aÅ‹ tÉ•y laÅ‹ tu
  ```
- [ ] è®¡ç®—éŸ³ç´ å‡†ç¡®ç‡

**è¾“å‡º**: G2P å‡†ç¡®ç‡æŠ¥å‘Š

---

### é˜¶æ®µ 4: UI é›†æˆä¸å¤šè¯­è¨€æ”¯æŒ

**ç›®æ ‡**: åœ¨ç°æœ‰åº”ç”¨ä¸­æ·»åŠ ä¸­æ–‡è¯­éŸ³åˆæˆåŠŸèƒ½

#### Task 4.1: ä¿®æ”¹ MainActivity
- [ ] æ·»åŠ è¯­è¨€é€‰æ‹©å™¨ (RadioButton: æ—¥è¯­/ä¸­æ–‡)
- [ ] æ ¹æ®è¯­è¨€åˆ‡æ¢ G2P ç³»ç»Ÿ:
  ```kotlin
  private lateinit var japaneseG2P: JapaneseG2PSystem
  private lateinit var chineseG2P: ChineseG2PSystem
  
  val phonemes = when(selectedLanguage) {
      "ja" -> japaneseG2P.textToPhonemes(text)
      "zh" -> chineseG2P.textToPhonemes(text)
      else -> throw IllegalArgumentException()
  }
  ```
- [ ] æ ¹æ®è¯­è¨€åˆ‡æ¢è¯­éŸ³åµŒå…¥:
  ```kotlin
  val voice = when(selectedLanguage) {
      "ja" -> "jf_nezumi"
      "zh" -> "zf_xiaoxiao"
      else -> throw IllegalArgumentException()
  }
  ```

**è¾“å‡º**: æ”¯æŒåŒè¯­è¨€çš„ UI

---

#### Task 4.2: æ·»åŠ ä¸­æ–‡é¢„è®¾å¥å­
- [ ] åˆ›å»º `ChinesePresets.kt`
- [ ] æ·»åŠ  5-10 ä¸ªä¸­æ–‡æµ‹è¯•å¥å­:
  ```kotlin
  data class ChineseSentence(
      val text: String,
      val translation: String,
      val phonemes: String  // é¢„è®¡ç®—çš„éŸ³ç´ 
  )
  ```

**è¾“å‡º**: `ChinesePresets.kt`

---

#### Task 4.3: å®Œæ•´æµç¨‹æµ‹è¯•
- [ ] æµ‹è¯•æ—¥è¯­åˆæˆ â†’ æ­£å¸¸
- [ ] æµ‹è¯•ä¸­æ–‡åˆæˆ â†’ æ­£å¸¸
- [ ] æµ‹è¯•è¯­è¨€åˆ‡æ¢ â†’ æ­£å¸¸
- [ ] æ€§èƒ½æµ‹è¯•: RTF < 1.0

**è¾“å‡º**: åŠŸèƒ½å®Œæ•´çš„åŒè¯­ TTS åº”ç”¨

---

### é˜¶æ®µ 5: ä¼˜åŒ–ä¸æ–‡æ¡£

#### Task 5.1: æ€§èƒ½ä¼˜åŒ–
- [ ] ç¼“å­˜æ‹¼éŸ³è½¬æ¢ç»“æœ
- [ ] ä¼˜åŒ–éŸ³ç´ æŸ¥æ‰¾ç®—æ³•
- [ ] å‡å°‘å†…å­˜å ç”¨

---

#### Task 5.2: å‡†ç¡®åº¦æå‡
- [ ] å¤„ç†å¤šéŸ³å­— (å¦‚æœ TinyPinyin ä¸æ”¯æŒï¼Œè€ƒè™‘ä¸Šä¸‹æ–‡è§„åˆ™)
- [ ] å¤„ç†å„¿åŒ–éŸ³
- [ ] å¤„ç†è½»å£°

---

#### Task 5.3: ç¼–å†™æ–‡æ¡£
- [ ] æ›´æ–° `README.md`ï¼Œæ·»åŠ ä¸­æ–‡æ”¯æŒè¯´æ˜
- [ ] åˆ›å»º `ä¸­æ–‡G2PæŠ€æœ¯æŠ¥å‘Š.md`
- [ ] å½•åˆ¶æ¼”ç¤ºè§†é¢‘ (å¯é€‰)

---

## ğŸ“Š æŠ€æœ¯æ ˆå¯¹æ¯”

| ç»„ä»¶ | Python ç«¯ | Android ç«¯ | å¤‡æ³¨ |
|------|-----------|-----------|------|
| **åˆ†è¯** | jieba | TinyPinyin (å†…ç½®) | ä¸­æ–‡æ— éœ€æ˜¾å¼åˆ†è¯ |
| **æ±‰å­—â†’æ‹¼éŸ³** | pypinyin | TinyPinyin | è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆ |
| **æ‹¼éŸ³â†’IPA** | misaki.zh | ChinesePinyinToIPA | éœ€è¦ç§»æ¤ |
| **æ•°å­—è½¬æ¢** | cn2an | (å¯é€‰) | åæœŸä¼˜åŒ– |
| **æ¨¡å‹** | PyTorch | ONNX Runtime | å®Œå…¨ç›¸åŒ âœ… |
| **éŸ³è‰²** | zf_xiaoxiao | zf_xiaoxiao.raw | æ ¼å¼è½¬æ¢ |

---

## ğŸš§ å·²çŸ¥é£é™©ä¸ç¼“è§£æªæ–½

### é£é™© 1: TinyPinyin å¤šéŸ³å­—å‡†ç¡®åº¦ä¸è¶³
**å½±å“**: ä¸­ç­‰ (éƒ¨åˆ†å¥å­è¯»éŸ³é”™è¯¯)  
**ç¼“è§£**: 
- å…ˆéªŒè¯å¸¸è§å¥å­çš„å‡†ç¡®åº¦
- å¦‚ä¸æ»¡è¶³ï¼Œè€ƒè™‘ç§»æ¤ pypinyin è¯å…¸ (çº¦ 50MB)

### é£é™© 2: å£°è°ƒå¤„ç†å¤æ‚
**å½±å“**: é«˜ (å¯èƒ½å½±å“è‡ªç„¶åº¦)  
**ç¼“è§£**:
- å…ˆå®ç°æ— å£°è°ƒç‰ˆæœ¬ (éªŒè¯å¯è¡Œæ€§)
- åç»­æ ¹æ®éŸ³è´¨å†³å®šæ˜¯å¦æ·»åŠ å£°è°ƒ

### é£é™© 3: ä¸ Python ç«¯è¾“å‡ºä¸ä¸€è‡´
**å½±å“**: é«˜ (å½±å“éŸ³è´¨)  
**ç¼“è§£**:
- åœ¨æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œå¯¹æ¯”æµ‹è¯•
- ä¿å­˜ Python ç«¯è¾“å‡ºä½œä¸º Golden Reference

---

## ğŸ“ˆ é¢„æœŸæˆæœ

### æœ€å°å¯è¡Œäº§å“ (MVP)
- âœ… æ”¯æŒä¸­æ–‡æ–‡æœ¬è¾“å…¥
- âœ… åŸºæœ¬å‡†ç¡®çš„æ‹¼éŸ³è½¬æ¢ (>80%)
- âœ… å¯å¬æ‡‚çš„è¯­éŸ³è¾“å‡º
- âœ… RTF < 1.0 (å®æ—¶åˆæˆ)

### å®Œæ•´ç‰ˆæœ¬
- âœ… å¤šéŸ³å­—æ­£ç¡®å¤„ç† (>90%)
- âœ… æ”¯æŒæ•°å­—ã€è‹±æ–‡æ··åˆè¾“å…¥
- âœ… è½»å£°ã€å„¿åŒ–éŸ³å¤„ç†
- âœ… åŒè¯­è¨€æ— ç¼åˆ‡æ¢

---

## ğŸ¬ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹: é˜¶æ®µ 0.1
1. æŸ¥çœ‹ `misaki/zh.py` æºç 
2. æå–æ‹¼éŸ³â†’IPA æ˜ å°„è¡¨
3. åˆ›å»º `misakiä¸­æ–‡G2Påˆ†ææŠ¥å‘Š.md`

**å‘½ä»¤**:
```bash
# æŸ¥çœ‹ misaki æºç 
code .venv/Lib/site-packages/misaki/zh.py

# æˆ–ç›´æ¥è¯»å–
cat .venv/Lib/site-packages/misaki/zh.py
```

---

## ğŸ“ å¼€å‘æ—¥å¿—

| æ—¥æœŸ | é˜¶æ®µ | å®Œæˆä»»åŠ¡ | å¤‡æ³¨ |
|------|------|----------|------|
| 2025-10-25 | 0.0 | åˆ›å»ºå®æ–½è®¡åˆ’ | - |
| 2025-10-25 | 0.1 | åˆ†æ misaki[zh] å®ç° | 21ä¸ªå£°æ¯ã€40ä¸ªéŸµæ¯ |
| 2025-10-25 | 0.2 | æµ‹è¯• pypinyin è½¬æ¢ | TONE3 æ ¼å¼: ni3 hao3 |
| 2025-10-25 | 0.3 | å¯¹æ¯” Python å®Œæ•´æµç¨‹ | å·²è·å– IPA åŸºå‡† |
| 2025-10-25 | 1.1 | å¯¼å‡ºä¸­æ–‡è¯­éŸ³åµŒå…¥ | zf_xiaoxiao.bin (510KB) |
| 2025-10-25 | 1.2 | éªŒè¯è¯­éŸ³åµŒå…¥ | åŠ¨æ€å¸§é€‰æ‹©éªŒè¯é€šè¿‡ |

---

**Let's Go! ğŸš€**
