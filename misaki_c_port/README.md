# Misaki C Port

**ç›®æ ‡**ï¼šå°† Python ç‰ˆ misaki G2P å¼•æ“ç§»æ¤ä¸ºçº¯ C å®ç°ï¼Œæ”¯æŒ iOS/Android æ— ç¼é›†æˆã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ä¸ºä»€ä¹ˆéœ€è¦ C ç‰ˆæœ¬ï¼Ÿ

1. **è·¨å¹³å°åŸç”Ÿæ”¯æŒ**
   - iOS å’Œ Android éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨
   - æ— éœ€æ‰“åŒ… Python è§£é‡Šå™¨
   - APK/IPA å¤§å°ä¸ä¼šå¢åŠ 

2. **æ€§èƒ½ä¼˜åŠ¿**
   - çº¯ C å®ç°ï¼Œé€Ÿåº¦æ›´å¿«
   - å†…å­˜å ç”¨æ›´å°
   - é€‚åˆç§»åŠ¨ç«¯å®æ—¶å¤„ç†

3. **ä¾èµ–æœ€å°åŒ–**
   - ä¸ä¾èµ– Python è¿è¡Œæ—¶
   - ä¸ä¾èµ–é‡å‹ NLP åº“
   - åªéœ€è¦åŸºç¡€çš„ C æ ‡å‡†åº“

### åŸå§‹é¡¹ç›®

- **æºé¡¹ç›®**: [hexgrad/misaki](https://github.com/hexgrad/misaki)
- **è®¸å¯è¯**: MIT License
- **ä½œè€…**: hexgrad (Kokoro TTS ä½œè€…)

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
misaki_c_port/
â”œâ”€â”€ README.md                  # æœ¬æ–‡ä»¶
â”œâ”€â”€ ARCHITECTURE.md            # æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ LICENSE                    # MIT License
â”‚
â”œâ”€â”€ include/                   # å…¬å…±å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ misaki.h              # ä¸»API
â”‚   â”œâ”€â”€ misaki_types.h        # æ•°æ®ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ misaki_config.h       # é…ç½®é€‰é¡¹
â”‚
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ tokenizer.c       # åˆ†è¯å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ g2p.c            # G2P æ¥å£
â”‚   â”‚   â””â”€â”€ utils.c          # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ segmenters/           # åˆ†è¯å®ç°ï¼ˆæ¯ä¸ªè¯­è¨€ä¸€ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ zh_segmenter.c   # ä¸­æ–‡åˆ†è¯ (jieba ç§»æ¤)
â”‚   â”‚   â”œâ”€â”€ ja_segmenter.c   # æ—¥æ–‡åˆ†è¯ (MeCab ç§»æ¤)
â”‚   â”‚   â””â”€â”€ ko_segmenter.c   # éŸ©æ–‡åˆ†è¯
â”‚   â”‚
â”‚   â”œâ”€â”€ g2p/                  # G2P å®ç°
â”‚   â”‚   â”œâ”€â”€ zh_g2p.c         # ä¸­æ–‡ G2P
â”‚   â”‚   â”œâ”€â”€ ja_g2p.c         # æ—¥æ–‡ G2P
â”‚   â”‚   â”œâ”€â”€ ko_g2p.c         # éŸ©æ–‡ G2P
â”‚   â”‚   â””â”€â”€ en_g2p.c         # è‹±æ–‡ G2P
â”‚   â”‚
â”‚   â””â”€â”€ data/                 # æ•°æ®åŠ è½½
â”‚       â”œâ”€â”€ dict_loader.c    # è¯å…¸åŠ è½½å™¨
â”‚       â””â”€â”€ resource.c       # èµ„æºç®¡ç†
â”‚
â”œâ”€â”€ data/                     # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ zh/                  # ä¸­æ–‡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ dict.txt         # è¯å…¸
â”‚   â”‚   â”œâ”€â”€ pinyin.txt       # æ‹¼éŸ³è¡¨
â”‚   â”‚   â””â”€â”€ rules.txt        # è§„åˆ™
â”‚   â”‚
â”‚   â”œâ”€â”€ ja/                  # æ—¥æ–‡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ dict.txt
â”‚   â”‚   â””â”€â”€ kana2phone.txt
â”‚   â”‚
â”‚   â”œâ”€â”€ ko/                  # éŸ©æ–‡æ•°æ®
â”‚   â””â”€â”€ en/                  # è‹±æ–‡æ•°æ®
â”‚
â”œâ”€â”€ tests/                   # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_zh.c
â”‚   â”œâ”€â”€ test_ja.c
â”‚   â””â”€â”€ test_integration.c
â”‚
â”œâ”€â”€ bindings/                # è¯­è¨€ç»‘å®š
â”‚   â”œâ”€â”€ android/            # Android JNI
â”‚   â”œâ”€â”€ ios/                # iOS Objective-C
â”‚   â””â”€â”€ python/             # Python ctypes (ç”¨äºæµ‹è¯•)
â”‚
â””â”€â”€ tools/                   # å·¥å…·è„šæœ¬
    â”œâ”€â”€ extract_data.py     # ä» Python misaki æå–æ•°æ®
    â”œâ”€â”€ convert_dict.py     # è½¬æ¢è¯å…¸æ ¼å¼
    â””â”€â”€ benchmark.c         # æ€§èƒ½æµ‹è¯•
```

## ğŸ“Š æ¨¡å—åˆ’åˆ†

### ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒæŠ½è±¡

**tokenizer.h / tokenizer.c**
```c
// åˆ†è¯å™¨æ¥å£ï¼ˆæ‰€æœ‰è¯­è¨€é€šç”¨ï¼‰
typedef struct Tokenizer Tokenizer;
typedef struct Token {
    char *text;       // è¯æ–‡æœ¬
    char *tag;        // è¯æ€§æ ‡æ³¨
    char *phonemes;   // éŸ³ç´ 
} Token;

Tokenizer* tokenizer_create(const char *lang);
Token** tokenizer_segment(Tokenizer *t, const char *text, int *count);
void tokenizer_free(Tokenizer *t);
```

**g2p.h / g2p.c**
```c
// G2P æ¥å£ï¼ˆæ‰€æœ‰è¯­è¨€é€šç”¨ï¼‰
typedef struct G2P G2P;

G2P* g2p_create(const char *lang);
char* g2p_convert(G2P *g, const char *text);
void g2p_free(G2P *g);
```

### ç¬¬äºŒå±‚ï¼šè¯­è¨€ç‰¹å®šå®ç°

#### ä¸­æ–‡æ¨¡å—

**zh_segmenter.c** (jieba ç§»æ¤)
- åŸºäº Trie æ ‘çš„è¯å…¸åŒ¹é…
- éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHMMï¼‰æœªç™»å½•è¯è¯†åˆ«
- åŠ¨æ€è§„åˆ’æ±‚æœ€å¤§æ¦‚ç‡è·¯å¾„

**zh_g2p.c** (pypinyin + tone sandhi)
- æ‹¼éŸ³è¯å…¸æŸ¥è¯¢
- å£°è°ƒå˜åŒ–è§„åˆ™ (tone sandhi)
- å„¿åŒ–éŸ³å¤„ç†

#### æ—¥æ–‡æ¨¡å—

**ja_segmenter.c** (MeCab ç§»æ¤)
- åŸºäº Viterbi ç®—æ³•çš„å½¢æ€åˆ†æ
- UniDic è¯å…¸
- è¯æ€§æ ‡æ³¨

**ja_g2p.c** (OpenJTalk)
- å‡ååˆ°éŸ³ç´ æ˜ å°„
- ä¿ƒéŸ³ã€é•¿éŸ³å¤„ç†
- éŸ³è°ƒï¼ˆpitch accentï¼‰æ ‡æ³¨

#### éŸ©æ–‡æ¨¡å—

**ko_segmenter.c**
- åŸºäºè§„åˆ™çš„åˆ†è¯
- Jamo åˆ†è§£

**ko_g2p.c** (g2pK ç§»æ¤)
- éŸ©æ–‡å­—æ¯åˆ°éŸ³ç´ 
- è¿éŸ³è§„åˆ™

#### è‹±æ–‡æ¨¡å—

**en_g2p.c**
- CMUdict è¯å…¸
- æœªçŸ¥è¯å¤„ç†ï¼ˆå­—æ¯æ‹¼è¯»ï¼‰
- åŒå½¢å¼‚éŸ³è¯æ¶ˆæ­§

## ğŸ”§ å…³é”®æŠ€æœ¯éš¾ç‚¹

### 1. ä¸­æ–‡åˆ†è¯ (jieba ç§»æ¤)

**æ ¸å¿ƒç®—æ³•**ï¼š
- **Trie æ ‘**ï¼šè¯å…¸å‰ç¼€æ ‘ï¼ŒO(n) å¿«é€ŸåŒ¹é…
- **DAG (æœ‰å‘æ— ç¯å›¾)**ï¼šæšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†è¯ç»„åˆ
- **åŠ¨æ€è§„åˆ’**ï¼šæ±‚æœ€å¤§æ¦‚ç‡è·¯å¾„
- **HMM**ï¼šå¤„ç†æœªç™»å½•è¯

**æ•°æ®ç»“æ„**ï¼š
```c
typedef struct TrieNode {
    char word[64];           // è¯
    double freq;             // è¯é¢‘
    struct TrieNode *children[65536]; // Unicode å­èŠ‚ç‚¹
} TrieNode;
```

### 2. æ—¥æ–‡åˆ†è¯ (MeCab ç§»æ¤)

**æ ¸å¿ƒç®—æ³•**ï¼š
- **Viterbi ç®—æ³•**ï¼šæ±‚æœ€ä¼˜è·¯å¾„
- **Cost Model**ï¼šåŸºäºæˆæœ¬çš„è·¯å¾„é€‰æ‹©

**æŒ‘æˆ˜**ï¼š
- UniDic è¯å…¸å¾ˆå¤§ï¼ˆ~100MBï¼‰
- éœ€è¦å‹ç¼©å­˜å‚¨

### 3. æ‹¼éŸ³å¤„ç† (pypinyin ç§»æ¤)

**æ ¸å¿ƒ**ï¼š
- å¤šéŸ³å­—è¯å…¸ï¼ˆ20,902 ä¸ªæ±‰å­—ï¼‰
- å£°è°ƒæ ‡æ³¨ï¼ˆ5 ç§å£°è°ƒï¼‰
- å˜è°ƒè§„åˆ™ï¼ˆtone sandhiï¼‰

### 4. æ•°æ®æ–‡ä»¶ç®¡ç†

**æ ¼å¼é€‰æ‹©**ï¼š
- âŒ JSONï¼šè§£ææ…¢ï¼Œå ç”¨å¤§
- âœ… **äºŒè¿›åˆ¶æ ¼å¼**ï¼šå¿«é€ŸåŠ è½½ï¼Œç´§å‡‘å­˜å‚¨
- âœ… **mmap**ï¼šå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ŒæŒ‰éœ€åŠ è½½

## ğŸ“… å¼€å‘è®¡åˆ’

### é˜¶æ®µ 1ï¼šåŸºç¡€æ¡†æ¶ (1 å‘¨)

- [ ] åˆ›å»ºé¡¹ç›®ç»“æ„
- [ ] å®šä¹‰æ ¸å¿ƒæ¥å£ï¼ˆtokenizer, g2pï¼‰
- [ ] å®ç°å·¥å…·å‡½æ•°ï¼ˆUTF-8 å¤„ç†ã€å†…å­˜ç®¡ç†ï¼‰
- [ ] ç¼–å†™æµ‹è¯•æ¡†æ¶

### é˜¶æ®µ 2ï¼šä¸­æ–‡æ”¯æŒ (2-3 å‘¨)

- [ ] **ä¸­æ–‡åˆ†è¯å™¨** (jieba ç§»æ¤)
  - [ ] Trie æ ‘å®ç°
  - [ ] DAG æ„å»º
  - [ ] åŠ¨æ€è§„åˆ’æ±‚è§£
  - [ ] HMM æœªç™»å½•è¯è¯†åˆ«
  
- [ ] **ä¸­æ–‡ G2P**
  - [ ] æ‹¼éŸ³è¯å…¸åŠ è½½
  - [ ] å£°éŸµæ¯åˆ†ç¦»
  - [ ] å£°è°ƒå¤„ç†
  - [ ] å„¿åŒ–éŸ³è§„åˆ™

### é˜¶æ®µ 3ï¼šæ—¥æ–‡æ”¯æŒ (2-3 å‘¨)

- [ ] **æ—¥æ–‡åˆ†è¯å™¨** (MeCab æ ¸å¿ƒ)
  - [ ] Viterbi ç®—æ³•
  - [ ] UniDic è¯å…¸å‹ç¼©
  - [ ] å‡åè½¬æ¢
  
- [ ] **æ—¥æ–‡ G2P**
  - [ ] å‡ååˆ°éŸ³ç´ æ˜ å°„
  - [ ] OpenJTalk è§„åˆ™ç§»æ¤

### é˜¶æ®µ 4ï¼šè‹±æ–‡/éŸ©æ–‡æ”¯æŒ (1-2 å‘¨)

- [ ] è‹±æ–‡ CMUdict
- [ ] éŸ©æ–‡ g2pK ç§»æ¤

### é˜¶æ®µ 5ï¼šé›†æˆä¸ä¼˜åŒ– (1 å‘¨)

- [ ] Android JNI ç»‘å®š
- [ ] iOS Objective-C ç»‘å®š
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. é›¶ä¾èµ–
- åªä¾èµ– C æ ‡å‡†åº“
- æ‰€æœ‰ NLP é€»è¾‘è‡ªå·±å®ç°
- æ•°æ®æ–‡ä»¶è‡ªåŒ…å«

### 2. å†…å­˜å®‰å…¨
- æ˜ç¡®çš„å†…å­˜ç®¡ç†
- é¿å…å†…å­˜æ³„æ¼
- è¾¹ç•Œæ£€æŸ¥

### 3. é«˜æ€§èƒ½
- æ•°æ®ç»“æ„ä¼˜åŒ–ï¼ˆTrie, Hash Tableï¼‰
- ç¼“å­˜å‹å¥½
- æœ€å°åŒ–å†…å­˜åˆ†é…

### 4. å¯ç§»æ¤æ€§
- æ ‡å‡† C99
- è·¨å¹³å°ç¼–è¯‘
- å¤§å°ç«¯å…¼å®¹

## ğŸ“– å‚è€ƒèµ„æº

### åŸå§‹é¡¹ç›®
- [hexgrad/misaki](https://github.com/hexgrad/misaki) - Python ç‰ˆæœ¬
- [PaddleSpeech](https://github.com/PaddlePaddle/PaddleSpeech) - ä¸­æ–‡å‰ç«¯å‚è€ƒ

### åˆ†è¯ç®—æ³•
- [jieba](https://github.com/fxsjy/jieba) - ä¸­æ–‡åˆ†è¯
- [MeCab](https://taku910.github.io/mecab/) - æ—¥æ–‡åˆ†è¯
- [KoNLPy](https://konlpy.org/) - éŸ©æ–‡åˆ†è¯

### G2P å¼•æ“
- [pypinyin](https://github.com/mozillazg/python-pinyin) - ä¸­æ–‡æ‹¼éŸ³
- [OpenJTalk](http://open-jtalk.sp.nitech.ac.jp/) - æ—¥æ–‡éŸ³ç´ 
- [g2pK](https://github.com/Kyubyong/g2pK) - éŸ©æ–‡éŸ³ç´ 

## ğŸ¤ è´¡çŒ®æŒ‡å—

æœ¬é¡¹ç›®æ˜¯ [Kokoro-ja-demo](https://github.com/lemonhall/kokoro-ja-demo) çš„å­é¡¹ç›®ã€‚

### ä»£ç é£æ ¼
- éµå¾ª C99 æ ‡å‡†
- ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›
- å‡½æ•°å‘½åï¼š`module_action()` (å¦‚ `zh_segment()`)
- å˜é‡å‘½åï¼š`snake_case`

### æµ‹è¯•è¦æ±‚
- æ¯ä¸ªæ¨¡å—éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
- æ€§èƒ½æµ‹è¯•ï¼ˆä¸ Python ç‰ˆæœ¬å¯¹æ¯”ï¼‰
- å†…å­˜æ³„æ¼æ£€æµ‹ï¼ˆvalgrindï¼‰

## ğŸ“„ è®¸å¯è¯

MIT License - ç»§æ‰¿è‡ªåŸå§‹ misaki é¡¹ç›®

---

**çŠ¶æ€**: ğŸš§ è§„åˆ’é˜¶æ®µ

**å¼€å§‹æ—¥æœŸ**: 2025-10-25

**é¢„è®¡å®Œæˆ**: 2025-12-15 (çº¦ 7-8 å‘¨)
