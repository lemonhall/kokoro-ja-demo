#!/bin/bash
# run_all_tests.sh
# 
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶
# 

set -e

BUILD_DIR="build"
TEST_PASSED=0
TEST_FAILED=0

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  Misaki C Port - æµ‹è¯•å¥—ä»¶"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

cd "$BUILD_DIR" || exit 1

# æµ‹è¯•åˆ—è¡¨
TESTS=(
    "test_string:å­—ç¬¦ä¸²å·¥å…·"
    "test_tsv:TSV è§£æå™¨"
    "test_trie:Trie æ•°æ®ç»“æ„"
    "test_dict:è¯å…¸åŠ è½½"
    "test_tokenizer_zh:ä¸­æ–‡åˆ†è¯å™¨"
    "test_tokenizer_en:è‹±æ–‡åˆ†è¯å™¨"
    "test_tokenizer_ja:æ—¥æ–‡åˆ†è¯å™¨"
    "test_g2p_zh:ä¸­æ–‡ G2P"
    "test_g2p_en:è‹±æ–‡ G2P"
    "test_g2p_ja:æ—¥æ–‡ G2P"
)

# è¿è¡Œæµ‹è¯•
for test_item in "${TESTS[@]}"; do
    IFS=':' read -r test_name test_desc <<< "$test_item"
    
    if [ ! -f "./$test_name" ]; then
        echo -e "${YELLOW}âš ï¸  è·³è¿‡: $test_desc ($test_name ä¸å­˜åœ¨)${NC}"
        continue
    fi
    
    echo ""
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${BLUE}ğŸ§ª è¿è¡Œæµ‹è¯•: $test_desc${NC}"
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    
    if ./"$test_name"; then
        echo -e "${GREEN}âœ… $test_desc æµ‹è¯•é€šè¿‡${NC}"
        ((TEST_PASSED++))
    else
        echo -e "${RED}âŒ $test_desc æµ‹è¯•å¤±è´¥${NC}"
        ((TEST_FAILED++))
    fi
done

# æ€»ç»“
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  æµ‹è¯•æ€»ç»“"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "  ${GREEN}âœ… é€šè¿‡: $TEST_PASSED${NC}"
echo -e "  ${RED}âŒ å¤±è´¥: $TEST_FAILED${NC}"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

if [ $TEST_FAILED -eq 0 ]; then
    echo -e "${GREEN}ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼${NC}"
    exit 0
else
    echo -e "${RED}âš ï¸  æœ‰æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼${NC}"
    exit 1
fi
