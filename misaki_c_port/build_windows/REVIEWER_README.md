# TTS音频对比审听工具使用说明

## 📋 功能特性

这是一个基于Flask的Web工具，用于批量审听和评价TTS音频测试结果。

### 核心功能
- ✅ **音频对比播放**：并排播放C版本和Python版本的音频
- ✅ **音素对比显示**：清晰展示两个版本的音素序列
- ✅ **三级评价系统**：
  - 🟢 C版本OK（C版本达标）
  - 🟠 C版本不OK（C版本有问题但Python正常）
  - 🔴 两者都不OK（两个版本都有问题）
- ✅ **备注功能**：可选添加详细问题描述
- ✅ **翻页导航**：快速浏览所有测试用例
- ✅ **自动保存**：评价结果实时保存到JSON文件
- ✅ **进度追踪**：实时显示审听进度和统计
- ✅ **键盘快捷键**：
  - `←` / `→` : 上一组/下一组
  - `1` / `2` / `3` : 快速选择评价状态

## 🚀 快速开始

### 1. 安装依赖
```bash
# 使用虚拟环境安装Flask
e:/development/kokoro-ja-demo/.venv/Scripts/python.exe -m pip install flask
```

### 2. 运行测试生成音频（如果还没生成）
```bash
cd e:/development/kokoro-ja-demo/misaki_c_port/build_windows
e:/development/kokoro-ja-demo/.venv/Scripts/python.exe batch_tts_test.py
```

这将生成：
- `batch_output/` 目录
- 189组音频文件（C版本和Python版本各189个）
- 189个音素对比文件

### 3. 启动Web审听工具
```bash
cd e:/development/kokoro-ja-demo/misaki_c_port/build_windows
e:/development/kokoro-ja-demo/.venv/Scripts/python.exe audio_reviewer.py
```

### 4. 打开浏览器
访问: http://127.0.0.1:5000

## 📖 使用流程

1. **打开页面**：浏览器会自动加载第一个测试用例

2. **听音频**：
   - 左边播放C版本音频
   - 右边播放Python版本音频
   - 可反复播放对比

3. **查看音素**：
   - 上方显示输入文本
   - 中间显示两个版本的音素序列
   - 可以对比是否有差异

4. **进行评价**：
   - 点击三个按钮之一：
     - **✓ C版本OK**：C版本发音正确
     - **⚠ C版本不OK**：C版本有问题
     - **✗ 两者都不OK**：两个版本都有问题

5. **添加备注（可选）**：
   - 如果需要详细说明问题，可在备注框输入
   - 例如："声调错误"、"多音字读错"等

6. **自动保存**：
   - 选择评价后自动保存
   - 右上角会显示"✓ 已保存"提示

7. **翻页继续**：
   - 点击"下一组"或使用右箭头键
   - 继续审听下一个用例

## 📊 数据存储

评价结果保存在 `batch_output/review_results.json`：

```json
{
  "001": {
    "status": "c_ok",
    "note": "",
    "timestamp": "2024-10-26T..."
  },
  "002": {
    "status": "c_fail",
    "note": "多音字'行'读音错误",
    "timestamp": "2024-10-26T..."
  }
}
```

## 🎯 评价标准参考

### C版本OK (c_ok)
- 发音准确
- 声调正确
- 音素转换无误
- 韵律自然

### C版本不OK (c_fail)
- 多音字读错
- 声调错误
- 音素缺失或错误
- 轻声处理不当

### 两者都不OK (both_fail)
- 拼音转换错误
- 分词问题导致读音错误
- 原始文本处理问题
- 需要修改测试用例或G2P逻辑

## 📈 统计信息

页面顶部实时显示：
- 总用例数
- 已审听数量
- 各评价类型数量
- 完成进度条

## ⌨️ 键盘快捷键

- `←` (左箭头): 上一组
- `→` (右箭头): 下一组  
- `1`: 选择"C版本OK"
- `2`: 选择"C版本不OK"
- `3`: 选择"两者都不OK"

## 💡 使用技巧

1. **批量审听建议**：
   - 先快速过一遍，只标记明显有问题的
   - 第二轮仔细听，添加详细备注

2. **问题分类**：
   - 多音字问题 → 需要更新词典
   - 声调问题 → 检查变调规则
   - 音素错误 → 检查G2P映射

3. **进度管理**：
   - 可以随时关闭，下次继续
   - 已评价的会保留在JSON中
   - 进度条显示完成百分比

## 🔧 故障排除

### 音频无法播放
- 检查 `batch_output/` 目录下是否有WAV文件
- 确认浏览器支持WAV格式

### 页面无法加载
- 确认Flask服务正在运行
- 检查5000端口是否被占用

### 评价无法保存
- 检查 `batch_output/` 目录权限
- 查看控制台是否有错误信息

## 📝 后续分析

审听完成后，可以：
1. 统计各类问题数量
2. 导出有问题的用例列表
3. 针对性优化G2P算法
4. 更新测试用例

---

**祝审听顺利！** 🎉
