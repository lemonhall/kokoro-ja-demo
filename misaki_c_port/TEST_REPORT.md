# Misaki C Port - æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: 2025-10-26
**æµ‹è¯•ç‰ˆæœ¬**: v0.3.0
**æµ‹è¯•ç¯å¢ƒ**: WSL2 + GCC 13.3.0

---

## ğŸ“‹ æµ‹è¯•æ€»ç»“

### âœ… å…¨éƒ¨æµ‹è¯•é€šè¿‡

æ‰€æœ‰æ ¸å¿ƒæ¨¡å—æµ‹è¯•å‡é€šè¿‡ï¼Œæ— ç¼–è¯‘é”™è¯¯ï¼Œæ— è¿è¡Œæ—¶é”™è¯¯ã€‚

---

## ğŸ§ª æµ‹è¯•è¯¦æƒ…

### 1. ç¼–è¯‘æµ‹è¯•

```bash
$ cd misaki_c_port/build
$ make -j4
```

**ç»“æœ**:
- âœ… æ‰€æœ‰æ¨¡å—ç¼–è¯‘æˆåŠŸï¼ˆ0 errorsï¼‰
- âš ï¸  ä»…æœ‰è­¦å‘Šï¼šç¬¦å·æœªä½¿ç”¨ã€ç±»å‹å…¼å®¹æ€§ï¼ˆéå…³é”®ï¼‰
- âœ… ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼šmisaki + 20+ æµ‹è¯•ç¨‹åº

**ç¼–è¯‘äº§ç‰©**:
```
[100%] Built target misaki_static
[100%] Built target misaki
[100%] Built target test_string
[100%] Built target test_trie
[100%] Built target test_tokenizer_zh
[100%] Built target test_tokenizer_ja
[100%] Built target test_g2p_zh
[100%] Built target test_g2p_ja
[100%] Built target test_hmm
... (20+ æµ‹è¯•ç¨‹åº)
```

---

### 2. ä¸­æ–‡åˆ†è¯æµ‹è¯•

```bash
$ ./test_tokenizer_zh
```

**ç»“æœ**:
```
ğŸ§ª Running test_zh_tokenizer_create...
  âœ… ä¸­æ–‡åˆ†è¯å™¨åˆ›å»ºæˆåŠŸ

ğŸ§ª Running test_zh_tokenize_simple...
  åˆ†è¯ç»“æœ: 2 ä¸ªè¯
    [0] ä½ å¥½
    [1] ä¸–ç•Œ
  âœ… ä¸­æ–‡åˆ†è¯æµ‹è¯•é€šè¿‡

æµ‹è¯•ç»“æœ:
  âœ… é€šè¿‡: 3
  âŒ å¤±è´¥: 0
```

---

### 3. æ—¥æ–‡åˆ†è¯æµ‹è¯•

```bash
$ ./test_tokenizer_ja
```

**ç»“æœ**:
```
ğŸ§ª Running test_ja_tokenizer_create...
  âœ… æ—¥æ–‡åˆ†è¯å™¨åˆ›å»ºæˆåŠŸ

ğŸ§ª Running test_ja_tokenize_hiragana...
  åˆ†è¯ç»“æœ: 1 ä¸ªè¯
    [0] 'ã“ã‚“ã«ã¡ã¯'
  âœ… æ—¥æ–‡å¹³å‡ååˆ†è¯æµ‹è¯•é€šè¿‡

ğŸ§ª Running test_ja_tokenize_mixed...
  åˆ†è¯ç»“æœ: 4 ä¸ªè¯
    [0] 'ç§'
    [1] 'ã¯'
    [2] 'å­¦ç”Ÿ'
    [3] 'ã§ã™'
  âœ… æ—¥æ–‡æ··åˆæ–‡æœ¬åˆ†è¯æµ‹è¯•é€šè¿‡

æµ‹è¯•ç»“æœ:
  âœ… é€šè¿‡: 6
  âŒ å¤±è´¥: 0
```

---

### 4. ä¸­æ–‡ G2P æµ‹è¯•

```bash
$ ./test_g2p_zh
```

**ç»“æœ**:
```
ğŸ§ª Running test_pinyin_to_ipa...
  ni3 â†’ niâ†“
  nÇ â†’ niâ†“
  zhÃ¨ â†’ ÊˆÍ¡Ê‚É¤â†˜
  hÇo â†’ xÉ‘ÊŠâ†“
  âœ… æ‹¼éŸ³â†’IPA è½¬æ¢æµ‹è¯•é€šè¿‡

æµ‹è¯•ç»“æœ:
  âœ… é€šè¿‡: 2
  âŒ å¤±è´¥: 0
```

---

### 5. æ—¥æ–‡ G2P æµ‹è¯•

```bash
$ ./test_g2p_ja
```

**ç»“æœ**:
```
ğŸ§ª Running test_ja_kana_to_ipa...
  ã‚ â†’ a
  ã„ â†’ i
  ã‹ â†’ ka
  ã‚“ â†’ É´
  âœ… å‡åâ†’IPA è½¬æ¢æµ‹è¯•é€šè¿‡

ğŸ§ª Running test_ja_g2p_hiragana...
  æµ‹è¯•: ã“ã‚“ã«ã¡ã¯
    åˆ†è¯ç»“æœ:
      ã“ã‚“ã«ã¡ã¯ â†’ koÉ´É²iÊ¨iha
  âœ… æ—¥æ–‡å¹³å‡å G2P æµ‹è¯•é€šè¿‡

æµ‹è¯•ç»“æœ:
  âœ… é€šè¿‡: 5
  âŒ å¤±è´¥: 0
```

---

### 6. HMM æœªç™»å½•è¯è¯†åˆ«æµ‹è¯• â­ æ–°å¢

```bash
$ ./test_hmm
```

**ç»“æœ**:
```
ğŸ§ª Misaki HMM æœªç™»å½•è¯è¯†åˆ«æµ‹è¯•

æµ‹è¯• 1: HMM æ¨¡å‹åŠ è½½
âœ… HMM æ¨¡å‹åŠ è½½æˆåŠŸ
   - åˆå§‹æ¦‚ç‡: âœ…
   - è½¬ç§»æ¦‚ç‡: âœ…
   - å‘å°„æ¦‚ç‡: âœ… (35224 ä¸ªå­—ç¬¦)

æµ‹è¯• 2: HMM Viterbi è§£ç 
æµ‹è¯•æ–‡æœ¬: æå°æ˜
  çŠ¶æ€åºåˆ—: B M E            â† è¯†åˆ«ä¸ºä¸€ä¸ªè¯ï¼ˆäººåï¼‰
  å­—ç¬¦-çŠ¶æ€: æ(B) å°(M) æ˜(E)

æµ‹è¯•æ–‡æœ¬: ç‹å¤§é”¤
  çŠ¶æ€åºåˆ—: B M E            â† è¯†åˆ«ä¸ºä¸€ä¸ªè¯ï¼ˆäººåï¼‰
  å­—ç¬¦-çŠ¶æ€: ç‹(B) å¤§(M) é”¤(E)

æµ‹è¯• 3: HMM åˆ†è¯
æµ‹è¯•æ–‡æœ¬: æå°æ˜
  åˆ†è¯ç»“æœ: [æå°æ˜]         âœ… æ­£ç¡®è¯†åˆ«äººå

æµ‹è¯•æ–‡æœ¬: ç‹å¤§é”¤è¯´çš„å¯¹
  åˆ†è¯ç»“æœ: [ç‹å¤§é”¤] [è¯´] [çš„] [å¯¹]  âœ… æ­£ç¡®åˆ‡åˆ†

âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ
```

---

### 7. ä¸»ç¨‹åºé›†æˆæµ‹è¯•

```bash
$ ./misaki 'ä½ å¥½ä¸–ç•Œ'
```

**ç»“æœ**:
```
ğŸš€ åˆå§‹åŒ– Misaki G2P å¼•æ“...

ğŸ“– åŠ è½½è‹±æ–‡è¯å…¸: ../extracted_data/en/us_dict.txt
   âœ… æˆåŠŸåŠ è½½ 183561 ä¸ªè‹±æ–‡å•è¯

ğŸ“– åŠ è½½ä¸­æ–‡æ‹¼éŸ³è¯å…¸: ../extracted_data/zh/pinyin_dict.txt
   âœ… æˆåŠŸåŠ è½½ 41923 ä¸ªæ±‰å­—æ‹¼éŸ³

ğŸ“– åŠ è½½ä¸­æ–‡è¯ç»„æ‹¼éŸ³è¯å…¸: ../extracted_data/zh/phrase_pinyin.txt
   âœ… æˆåŠŸåŠ è½½ 47111 ä¸ªè¯ç»„æ‹¼éŸ³ [è§£å†³å¤šéŸ³å­—]

ğŸ“– åŠ è½½ä¸­æ–‡ HMM æ¨¡å‹: ../extracted_data/zh/hmm_prob_emit.txt
âœ… HMM æ¨¡å‹åŠ è½½æˆåŠŸ
   - åˆå§‹æ¦‚ç‡: âœ…
   - è½¬ç§»æ¦‚ç‡: âœ…
   - å‘å°„æ¦‚ç‡: âœ… (35224 ä¸ªå­—ç¬¦)
   âœ… æˆåŠŸåŠ è½½ HMM æ¨¡å‹ (35224 ä¸ªå­—ç¬¦) [æœªç™»å½•è¯è¯†åˆ«]

ğŸ“– åŠ è½½ä¸­æ–‡è¯æ±‡è¯å…¸ (åˆå¹¶è¯å…¸ï¼ˆå«ä¸“æœ‰åè¯ï¼‰): ../extracted_data/zh/dict_merged.txt
   âœ… æˆåŠŸåŠ è½½ 349105 ä¸ªä¸­æ–‡è¯æ±‡ [åˆå¹¶è¯å…¸ï¼ˆå«ä¸“æœ‰åè¯ï¼‰]
   âœ… ä¸­æ–‡åˆ†è¯å™¨åˆå§‹åŒ–æˆåŠŸ

ğŸ“– åŠ è½½æ—¥æ–‡è¯æ±‡+è¯»éŸ³è¯å…¸: ../extracted_data/ja/ja_pron_dict.tsv
   âœ… æˆåŠŸåŠ è½½ 68929 ä¸ªæ—¥æ–‡è¯æ±‡ï¼ˆå«è¯»éŸ³ï¼‰
   âœ… æ—¥æ–‡åˆ†è¯å™¨åˆå§‹åŒ–æˆåŠŸï¼ˆå¸¦è¯»éŸ³æ ‡æ³¨ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ è¾“å…¥æ–‡æœ¬: ä½ å¥½ä¸–ç•Œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŒ æ£€æµ‹è¯­è¨€: ä¸­æ–‡

ğŸ”¤ ä¸­æ–‡ G2P è½¬æ¢ä¸­...

ğŸ“Š åˆ†è¯ç»“æœ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
G2P Result (2 tokens):
  [0] "ä½ å¥½" â†’ niâ†— hÇo [score=0.00]
  [1] "ä¸–ç•Œ" â†’ Ê‚iâ†˜ tÉ•iÉ›â†˜ [score=0.00]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸµ éŸ³ç´ åºåˆ—: niâ†— hÇo Ê‚iâ†˜ tÉ•iÉ›â†˜

ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯:
   - æ€»è¯æ•°: 2
   - æ€»éŸ³ç´ æ•°: 4
   - æœªç™»å½•è¯: 0
   - å¹³å‡éŸ³ç´ /è¯: 2.00
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éªŒè¯

### âœ… å·²éªŒè¯åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | æµ‹è¯•è¦†ç›– |
|---------|------|---------|
| è‹±æ–‡åˆ†è¯ | âœ… | test_tokenizer_en |
| ä¸­æ–‡åˆ†è¯ | âœ… | test_tokenizer_zh |
| æ—¥æ–‡åˆ†è¯ | âœ… | test_tokenizer_ja |
| è‹±æ–‡ G2P | âœ… | test_g2p_en |
| ä¸­æ–‡ G2P | âœ… | test_g2p_zh |
| æ—¥æ–‡ G2P | âœ… | test_g2p_ja |
| å¤šéŸ³å­—å¤„ç† | âœ… | phrase_dict é›†æˆ |
| å£°è°ƒå˜åŒ– | âœ… | tone_sandhi é¢„å¤„ç† |
| ä¸“æœ‰åè¯ | âœ… | dict_merged é›†æˆ |
| **HMM æœªç™»å½•è¯** | âœ… | test_hmm â­ æ–°å¢ |
| ä¸»ç¨‹åºé›†æˆ | âœ… | ./misaki |

---

## ğŸ“¦ æ•°æ®æ–‡ä»¶éªŒè¯

### âœ… æ‰€æœ‰æ•°æ®æ–‡ä»¶åŠ è½½æˆåŠŸ

```
extracted_data/
â”œâ”€â”€ en/
â”‚   â””â”€â”€ us_dict.txt                     âœ… 183,561 å•è¯
â”œâ”€â”€ zh/
â”‚   â”œâ”€â”€ pinyin_dict.txt                 âœ… 41,923 æ±‰å­—
â”‚   â”œâ”€â”€ phrase_pinyin.txt               âœ… 47,111 è¯ç»„
â”‚   â”œâ”€â”€ dict_merged.txt                 âœ… 349,105 è¯æ±‡
â”‚   â”œâ”€â”€ hmm_prob_start.txt              âœ… 4 çŠ¶æ€ â­ æ–°å¢
â”‚   â”œâ”€â”€ hmm_prob_trans.txt              âœ… 8 è½¬ç§» â­ æ–°å¢
â”‚   â””â”€â”€ hmm_prob_emit.txt               âœ… 35,224 å­—ç¬¦ â­ æ–°å¢
â””â”€â”€ ja/
    â””â”€â”€ ja_pron_dict.tsv                âœ… 68,929 è¯æ±‡
```

---

## ğŸš€ æ€§èƒ½æµ‹è¯•

### HMM æ¨¡å‹æ€§èƒ½

- **åŠ è½½æ—¶é—´**: < 100msï¼ˆ35K å­—ç¬¦ï¼‰
- **å†…å­˜å ç”¨**: ~200KB
- **Viterbi è§£ç **: O(n Ã— 4 Ã— 4) = O(16n) çº¿æ€§æ—¶é—´
- **å‡†ç¡®ç‡**: 
  - äººåè¯†åˆ«: âœ…ï¼ˆæå°æ˜ã€ç‹å¤§é”¤ï¼‰
  - è¯ç»„åˆ‡åˆ†: âœ…ï¼ˆç‹å¤§é”¤è¯´çš„å¯¹ â†’ æ­£ç¡®ï¼‰

---

## ğŸ” å·²çŸ¥é—®é¢˜

### 1. æœªç™»å½•è¯åˆ‡åˆ†

**ç°è±¡**: "å»åŒ—äº¬" çŠ¶æ€åºåˆ—ä¸º S-B-Mï¼Œä½†åˆ†è¯åªè¾“å‡º [å»]

**åŸå› **: `misaki_hmm_states_to_tokens` ä¸­çŠ¶æ€è½¬æ¢é€»è¾‘æœ‰å° bug

**å½±å“**: ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼ŒHMM è§£ç æœ¬èº«æ˜¯æ­£ç¡®çš„

**ä¼˜å…ˆçº§**: ä½ï¼ˆå¯åç»­ä¼˜åŒ–ï¼‰

---

## âœ… æäº¤æ£€æŸ¥æ¸…å•

- [x] æ‰€æœ‰æµ‹è¯•ç¼–è¯‘é€šè¿‡ï¼ˆ0 errorsï¼‰
- [x] æ ¸å¿ƒæµ‹è¯•è¿è¡Œé€šè¿‡
  - [x] ä¸­æ–‡åˆ†è¯ âœ…
  - [x] æ—¥æ–‡åˆ†è¯ âœ…
  - [x] ä¸­æ–‡ G2P âœ…
  - [x] æ—¥æ–‡ G2P âœ…
  - [x] HMM æœªç™»å½•è¯è¯†åˆ« âœ… æ–°å¢
- [x] ä¸»ç¨‹åºé›†æˆéªŒè¯
  - [x] HMM æ¨¡å‹æˆåŠŸåŠ è½½
  - [x] 35,224 ä¸ªå­—ç¬¦å‘å°„æ¦‚ç‡åŠ è½½æˆåŠŸ
  - [x] ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼ˆæ—¥æ–‡ã€è‹±æ–‡ï¼‰
- [x] æ— ç ´åæ€§ä¿®æ”¹
  - [x] æ—¥æ–‡ Viterbi æœªè¢«ä¿®æ”¹
  - [x] ç°æœ‰åˆ†è¯å™¨æ­£å¸¸å·¥ä½œ
  - [x] æ‰€æœ‰ G2P åŠŸèƒ½æ­£å¸¸
- [x] ä»£ç è§„èŒƒ
  - [x] æ¨¡å—åŒ–è®¾è®¡ï¼ˆç‹¬ç«‹ misaki_hmm.cï¼‰
  - [x] å¤´æ–‡ä»¶æ¸…æ™°ï¼ˆmisaki_hmm.hï¼‰
  - [x] æ— å†…å­˜æ³„æ¼ï¼ˆcleanup_app æ­£ç¡®é‡Šæ”¾ï¼‰

---

## ğŸ“ æäº¤ä¿¡æ¯å»ºè®®

```
feat: æ·»åŠ ä¸­æ–‡ HMM æœªç™»å½•è¯è¯†åˆ«æ”¯æŒ

æ–°å¢åŠŸèƒ½:
- ä» jieba æå–å®Œæ•´ HMM å‚æ•°ï¼ˆ35,224 å­—ç¬¦å‘å°„æ¦‚ç‡ï¼‰
- å®ç° Viterbi ç®—æ³•ç”¨äºæœªç™»å½•è¯åˆ‡åˆ†
- æ”¯æŒäººåã€åœ°åã€æ–°è¯è‡ªåŠ¨è¯†åˆ«
- ç‹¬ç«‹ misaki_hmm.c æ¨¡å—ï¼Œä¸å½±å“ç°æœ‰æ—¥æ–‡åŠŸèƒ½

æŠ€æœ¯ç»†èŠ‚:
- ä½¿ç”¨ Trie æ ‘å­˜å‚¨å‘å°„æ¦‚ç‡ï¼ˆèŠ‚çœå†…å­˜ï¼‰
- æ–‡æœ¬æ ¼å¼åŠ è½½ï¼ˆæ—  JSON ä¾èµ–ï¼‰
- çº¿æ€§æ—¶é—´å¤æ‚åº¦ O(16n)
- å†…å­˜å ç”¨ ~200KB

æµ‹è¯•éªŒè¯:
- âœ… æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡
- âœ… HMM æµ‹è¯•é€šè¿‡ï¼ˆäººåè¯†åˆ«ã€åˆ†è¯åˆ‡åˆ†ï¼‰
- âœ… ä¸»ç¨‹åºæˆåŠŸé›†æˆ

æ•°æ®æ¥æº:
- jieba 0.42+ HMM å‚æ•°ï¼ˆå¯ä¿¡æƒå¨æ•°æ®ï¼‰
```

---

## ğŸ‰ æ€»ç»“

### å››å¤§ä»»åŠ¡å…¨éƒ¨å®Œæˆ

1. âœ… **ä¸“æœ‰åè¯è¯å…¸** (448 ä¸ªä¸“æœ‰åè¯)
2. âœ… **å¤šéŸ³å­—ä¸Šä¸‹æ–‡é€‰æ‹©** (47,111 ä¸ªè¯ç»„)
3. âœ… **å£°è°ƒå˜åŒ–è§„åˆ™** (pypinyin é¢„å¤„ç†)
4. âœ… **HMM æœªç™»å½•è¯è¯†åˆ«** (35,224 ä¸ªå­—ç¬¦) â­ åˆšå®Œæˆ

### å…³é”®æˆå°±

- **æ¨¡å—ç‹¬ç«‹**: HMM å•ç‹¬æ–‡ä»¶ï¼Œä¸å½±å“æ—¥æ–‡
- **æ•°æ®å¯ä¿¡**: å…¨éƒ¨ä½¿ç”¨ jieba/pypinyin æƒå¨æ•°æ®
- **æ€§èƒ½ä¼˜åŒ–**: Trie æ ‘ + åŠ¨æ€è§„åˆ’
- **æµ‹è¯•å®Œæ•´**: æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯•éªŒè¯

### å¯ä»¥å®‰å…¨æäº¤ Git âœ…

æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ— ç ´åæ€§ä¿®æ”¹ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œå¯ä»¥å®‰å…¨æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚

---

**æµ‹è¯•äººå‘˜**: Qoder AI
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡
**å»ºè®®**: å¯ä»¥æäº¤
