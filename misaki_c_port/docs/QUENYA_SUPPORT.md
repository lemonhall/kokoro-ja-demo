# Quenya (æ˜†é›…è¯­) G2P Support Implementation

## é¡¹ç›®èƒŒæ™¯

ä¸º misaki_c_port æ·»åŠ æ˜†é›…è¯­ï¼ˆQuenyaï¼Œæ‰˜å°”é‡‘åˆ›é€ çš„ç²¾çµè¯­ï¼‰æ”¯æŒï¼Œå®ç°å¨±ä¹æ€§è´¨çš„ TTS åŠŸèƒ½ã€‚

**å®ç°è·¯å¾„ï¼š**
```
ä¸­æ–‡æ–‡æœ¬ â†’ AIç¿»è¯‘ â†’ æ˜†é›…è¯­æ–‡æœ¬ â†’ åˆ†è¯å™¨ â†’ G2Pè½¬æ¢ â†’ IPAéŸ³ç´  â†’ TTSåˆæˆ
```

## æ˜†é›…è¯­éŸ³ç³»è§„åˆ™

åŸºäºæƒå¨æ¥æºï¼šhttps://realelvish.net/pronunciation/quenya/

### å…ƒéŸ³ç³»ç»Ÿ

| å­—æ¯ | IPA | ç¤ºä¾‹ | è¯´æ˜ |
|------|-----|------|------|
| a, Ã¡ | /a/ | "father" | é•¿éŸ³ç¬¦è¡¨ç¤ºå»¶é•¿ |
| e, Ã« | /É›/ | "better" | åˆ†éŸ³ç¬¦ä¸å½±å“å‘éŸ³ |
| Ã© | /eË/ | "lake" | é•¿éŸ³ |
| i, Ã­ | /i/ | "machine" | |
| o | /É”/ | "thought" | |
| Ã³ | /oË/ | "oat" | é•¿éŸ³ |
| u, Ãº | /u/ | "brute" | |

**æ³¨æ„ï¼š** é•¿éŸ³ç¬¦ï¼ˆacute accent Ã¡, Ã©, Ã­, Ã³, Ãºï¼‰è¡¨ç¤ºå…ƒéŸ³éœ€å»¶é•¿å‘éŸ³ï¼Œåœ¨IPAä¸­ç”¨ `Ë` æ ‡è®°ã€‚

### åŒå…ƒéŸ³

| å­—æ¯ç»„åˆ | IPA | ç¤ºä¾‹ |
|----------|-----|------|
| ai | /aj/ | "twine" |
| au | /au/ | "loud" |
| iu | /iu/ | "music" |
| eu | /É›u/ | - |
| oi | /É”j/ | "boy" |
| ui | /uj/ | "gooey" |

### è¾…éŸ³ç³»ç»Ÿ

#### åŸºç¡€è¾…éŸ³ï¼ˆä¸è‹±è¯­ç›¸åŒï¼‰
- b, d, f, g, h, j, k/c, l, m, n, p, s, t, v, w, y, z

#### ç‰¹æ®Šè¾…éŸ³

| å­—æ¯ | IPA | è¯´æ˜ |
|------|-----|------|
| c, k | /k/ | æ€»æ˜¯å‘ /k/ éŸ³ |
| s | /s/ | æ€»æ˜¯å‘ /s/ éŸ³ |
| r | /r/ | é¢¤éŸ³ï¼ˆtrilled Rï¼‰ |
| qu | /kw/ | å¦‚ "queen" |
| Ã± | /Å‹/ | å¦‚ "sing" |
| ng | /Å‹É¡/ | å¦‚ "finger" |
| th, Ã¾ | /Î¸/ | å¦‚ "nothing" |
| z | /z/ | å¦‚ "zoo" |

#### è…­éŸ³åŒ–è¾…éŸ³ï¼ˆåæ¥ yï¼‰

| å­—æ¯ç»„åˆ | IPA | è¯´æ˜ |
|----------|-----|------|
| ty | /tj/ | è¾…éŸ³ååŠ  /j/ |
| ny | /nj/ | |
| ly | /lj/ | |
| ry | /rj/ | |
| sy | /sj/ | |
| hy | /hj/ | |

#### æ¸…åŒ–è¾…éŸ³ï¼ˆvoicelessï¼‰

| å­—æ¯ç»„åˆ | IPA | è¯´æ˜ |
|----------|-----|------|
| hl | /lÌ¥/ | æ¸…åŒ–çš„ lï¼ˆæ°”å£°ï¼‰ |
| hr | /rÌ¥/ | æ¸…åŒ–çš„ rï¼ˆæ°”å£°ï¼‰ |
| hw | /Ê/ | å¦‚ "white" |
| hy | /jÌŠ/ | æ¸…åŒ–çš„ y |

#### è¾…éŸ³ç°‡

| å­—æ¯ç»„åˆ | IPA | è¯´æ˜ |
|----------|-----|------|
| ht | /xt/ | å¦‚ "Bach" + "t" |
| pt | /Ï†t/ | /p/ å‘æˆ /f/ï¼Œå”‡å½¢å¦‚å» |

### é‡éŸ³è§„åˆ™

æ˜†é›…è¯­é‡éŸ³è§„åˆ™æ¸…æ™°ä¸”è§„åˆ™ï¼š

1. **1-3éŸ³èŠ‚è¯**ï¼šé‡éŸ³åœ¨ç¬¬ä¸€éŸ³èŠ‚
2. **4+éŸ³èŠ‚è¯**ï¼šé‡éŸ³åœ¨å€’æ•°ç¬¬ä¸‰éŸ³èŠ‚
3. **ä¾‹å¤–**ï¼šå€’æ•°ç¬¬äºŒéŸ³èŠ‚å¦‚æœ‰ä»¥ä¸‹ç‰¹å¾ï¼Œåˆ™é‡éŸ³ç§»è‡³è¯¥éŸ³èŠ‚ï¼š
   - æœ‰é•¿éŸ³ç¬¦ï¼ˆÃ¡, Ã©, Ã­, Ã³, Ãºï¼‰
   - åŒ…å«åŒå…ƒéŸ³ï¼ˆai, au, iu, eu, oi, uiï¼‰
   - è¾…éŸ³ç°‡ç»“å°¾ï¼ˆå¤šä¸ªè¾…éŸ³ï¼Œhl/hr/thç®—å•è¾…éŸ³ï¼‰

**ç¤ºä¾‹ï¼š**
- **Eldar** â†’ /ËˆÉ›l.dar/ ï¼ˆ2éŸ³èŠ‚ï¼Œé‡éŸ³ç¬¬ä¸€ï¼‰
- **Quenya** â†’ /ËˆkwÉ›n.ja/ ï¼ˆ2éŸ³èŠ‚ï¼Œé‡éŸ³ç¬¬ä¸€ï¼‰
- **Elessar** â†’ /É›.ËˆlÉ›s.sar/ ï¼ˆ3éŸ³èŠ‚ï¼Œç¬¬äºŒéŸ³èŠ‚æœ‰è¾…éŸ³ç°‡ssï¼‰
- **EÃ¤rendil** â†’ /É›.a.ËˆrÉ›n.dil/ ï¼ˆ4éŸ³èŠ‚ï¼Œå€’æ•°ç¬¬ä¸‰ï¼‰

## å®ç°è®¾è®¡

### æ–‡ä»¶ç»“æ„

```
misaki_c_port/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ misaki_tokenizer_qya.h    # æ˜†é›…è¯­åˆ†è¯å™¨å¤´æ–‡ä»¶
â”‚   â””â”€â”€ misaki_g2p_qya.h          # æ˜†é›…è¯­G2Pè½¬æ¢å™¨å¤´æ–‡ä»¶
â”œâ”€â”€ src/core/
â”‚   â”œâ”€â”€ misaki_tokenizer_qya.c    # æ˜†é›…è¯­åˆ†è¯å™¨å®ç°
â”‚   â””â”€â”€ misaki_g2p_qya.c          # æ˜†é›…è¯­G2Pè½¬æ¢å™¨å®ç°
â””â”€â”€ tests/
    â”œâ”€â”€ test_tokenizer_qya.c      # åˆ†è¯å™¨æµ‹è¯•
    â””â”€â”€ test_g2p_qya.c            # G2Pæµ‹è¯•
```

### åˆ†è¯ç­–ç•¥

æ˜†é›…è¯­åˆ†è¯ç›¸å¯¹ç®€å•ï¼š
1. æŒ‰ç©ºæ ¼åˆ†è¯
2. æ ‡ç‚¹ç¬¦å·ç‹¬ç«‹æˆtoken
3. æ•°å­—ä¿æŒåŸæ ·ï¼ˆæˆ–å¯é€‰è½¬æ¢ä¸ºæ˜†é›…è¯­æ•°è¯ï¼‰
4. ä¸éœ€è¦å¤æ‚çš„è¯å…¸æˆ–HMM

### G2Pè½¬æ¢æµç¨‹

```
è¾“å…¥æ–‡æœ¬ â†’ UTF-8è§£æ â†’ å­—ç¬¦åºåˆ—åˆ†æ
    â†“
è¯†åˆ«å­—æ¯ç»„åˆï¼ˆqu, ng, Ã±, thç­‰ï¼‰
    â†“
åŒå…ƒéŸ³è¯†åˆ«ï¼ˆai, au, iuç­‰ï¼‰
    â†“
å…ƒéŸ³é•¿éŸ³å¤„ç†ï¼ˆÃ¡â†’aËï¼‰
    â†“
è¾…éŸ³æ˜ å°„ï¼ˆåŒ…æ‹¬æ¸…åŒ–å’Œè…­éŸ³åŒ–ï¼‰
    â†“
é‡éŸ³è®¡ç®—å’Œæ ‡æ³¨
    â†“
IPAéŸ³ç´ åºåˆ—è¾“å‡º
```

### æ ¸å¿ƒå‡½æ•°æ¥å£

**åˆ†è¯å™¨ï¼š**
```c
// åˆå§‹åŒ–æ˜†é›…è¯­åˆ†è¯å™¨
MisakiTokenizer* misaki_tokenizer_qya_init(void);

// åˆ†è¯ï¼ˆæŒ‰ç©ºæ ¼å’Œæ ‡ç‚¹ï¼‰
int misaki_tokenize_qya(const char* text, MisakiToken** tokens);
```

**G2Pè½¬æ¢å™¨ï¼š**
```c
// åˆå§‹åŒ–æ˜†é›…è¯­G2P
MisakiG2P* misaki_g2p_qya_init(void);

// æ–‡æœ¬åˆ°éŸ³ç´ è½¬æ¢
char* misaki_g2p_qya_convert(const char* word);

// è®¡ç®—é‡éŸ³ä½ç½®
int calculate_stress_position(const char* word);

// è¯†åˆ«éŸ³èŠ‚
int count_syllables(const char* word);
```

### éŸ³ç´ æ˜ å°„è¡¨

å°†åœ¨ä»£ç ä¸­å®šä¹‰é™æ€æ˜ å°„è¡¨ï¼š
- å…ƒéŸ³æ˜ å°„è¡¨ï¼ˆå«é•¿éŸ³æ ‡è®°ï¼‰
- åŒå…ƒéŸ³æ˜ å°„è¡¨
- è¾…éŸ³æ˜ å°„è¡¨
- è¾…éŸ³ç°‡æ˜ å°„è¡¨
- ç‰¹æ®Šå­—ç¬¦æ˜ å°„

### è¯­è¨€æ£€æµ‹é›†æˆ

åœ¨ `misaki_lang_detect.c` ä¸­æ·»åŠ æ˜†é›…è¯­æ£€æµ‹è§„åˆ™ï¼š
- æ£€æµ‹ç‰¹æ®Šå­—ç¬¦ï¼šÃ±, Ã¾, Ã«
- æ£€æµ‹å¸¸è§è¯ç¼€ï¼š-ar, -ion, -iÃ«, -Ãºr
- æ£€æµ‹å¸¸è§å•è¯ï¼šQuenya, Eldar, Valar ç­‰

## æµ‹è¯•ç”¨ä¾‹

### åŸºç¡€å…ƒéŸ³æµ‹è¯•
```
Input: "aeiou"
Expected: "a É› i É” u"
```

### é•¿éŸ³æµ‹è¯•
```
Input: "Ã¡Ã©Ã­Ã³Ãº"
Expected: "aË eË iË oË uË"
```

### åŒå…ƒéŸ³æµ‹è¯•
```
Input: "ai au iu eu oi ui"
Expected: "aj au iu É›u É”j uj"
```

### è¾…éŸ³æµ‹è¯•
```
Input: "quenya"
Expected: "ËˆkwÉ›n ja"  (é‡éŸ³åœ¨ç¬¬ä¸€éŸ³èŠ‚)
```

### ç‰¹æ®Šè¾…éŸ³æµ‹è¯•
```
Input: "Ã±oldo"
Expected: "ËˆÅ‹É”l dÉ”"
```

### æ¸…åŒ–è¾…éŸ³æµ‹è¯•
```
Input: "hlÃ³ni"
Expected: "ËˆlÌ¥oË ni"
```

### é‡éŸ³æµ‹è¯•
```
Input: "Eldar"     â†’ /ËˆÉ›l dar/    (2éŸ³èŠ‚ï¼Œé‡éŸ³ç¬¬ä¸€)
Input: "Elessar"   â†’ /É› ËˆlÉ›s sar/  (3éŸ³èŠ‚ï¼Œssè¾…éŸ³ç°‡)
Input: "EÃ¤rendil"  â†’ /É› a ËˆrÉ›n dil/ (4éŸ³èŠ‚ï¼Œå€’æ•°ç¬¬ä¸‰)
Input: "NÃ¡mo"      â†’ /ËˆnaË mÉ”/    (é•¿éŸ³åœ¨ç¬¬ä¸€éŸ³èŠ‚)
```

### å®Œæ•´å¥å­æµ‹è¯•
```
Input: "Elen sÃ­la lÃºmenn' omentielvo"
Expected: (ç²¾çµè¯­ç»å…¸é—®å€™ï¼š"æ˜Ÿå…‰ç…§è€€æˆ‘ä»¬ç›¸é‡ä¹‹æ—¶"ï¼‰
```

## å®ç°é˜¶æ®µ

### Phase 1: æ ¸å¿ƒG2På®ç° âœ…
- [x] åˆ›å»ºè®¾è®¡æ–‡æ¡£
- [x] å®ç°åŸºç¡€å…ƒéŸ³æ˜ å°„
- [x] å®ç°åŒå…ƒéŸ³è¯†åˆ«
- [x] å®ç°è¾…éŸ³æ˜ å°„
- [x] å®ç°ç‰¹æ®Šè¾…éŸ³ç°‡å¤„ç†

### Phase 2: é‡éŸ³ç³»ç»Ÿ âœ…
- [x] å®ç°éŸ³èŠ‚è®¡æ•°ç®—æ³•
- [x] å®ç°é‡éŸ³ä½ç½®è®¡ç®—
- [x] å®ç°IPAé‡éŸ³æ ‡è®°

### Phase 3: åˆ†è¯å™¨ âœ…
- [x] å®ç°åŸºäºç©ºæ ¼çš„åˆ†è¯
- [x] å¤„ç†æ ‡ç‚¹ç¬¦å·
- [x] å¤„ç†æ’‡å·ï¼ˆå¦‚ omentielvoï¼‰

### Phase 4: é›†æˆå’Œæµ‹è¯• âœ…
- [x] æ·»åŠ è¯­è¨€æ£€æµ‹è§„åˆ™
- [x] ç¼–å†™å•å…ƒæµ‹è¯•
- [x] åˆ›å»ºæ¼”ç¤ºç¨‹åº
- [x] éªŒè¯å®Œæ•´å·¥ä½œæµ

### Phase 5: ä¼˜åŒ–å’Œæ–‡æ¡£ ğŸ“
- [x] åŸºç¡€åŠŸèƒ½å®Œæˆ
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
- [ ] å®Œå–„é”™è¯¯å¤„ç†ï¼ˆå¯é€‰ï¼‰
- [x] è¡¥å……ä½¿ç”¨æ–‡æ¡£

## å‚è€ƒèµ„æ–™

1. **æƒå¨éŸ³ç³»è§„åˆ™ï¼š** https://realelvish.net/pronunciation/quenya/
2. **è¯­æ³•å‚è€ƒï¼š** https://en.wikibooks.org/wiki/Quenya
3. **è¯å…¸èµ„æºï¼š** https://eldamo.org/
4. **IPAæ ‡å‡†ï¼š** International Phonetic Alphabet

## æ³¨æ„äº‹é¡¹

1. **UTF-8ç¼–ç ï¼š** æ˜†é›…è¯­ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼ˆÃ±, Ã¾, Ã«ç­‰ï¼‰ï¼Œå¿…é¡»æ­£ç¡®å¤„ç†UTF-8
2. **é•¿éŸ³ç¬¦å¤„ç†ï¼š** éœ€åŒºåˆ† Ã¡ å’Œ aï¼Œæ­£ç¡®æ˜ å°„ä¸º aË å’Œ a
3. **æ’‡å·å¤„ç†ï¼š** æ˜†é›…è¯­ä¸­æ’‡å·ç”¨äºçœç•¥ï¼Œéœ€ç‰¹æ®Šå¤„ç†
4. **Tengwaræ–‡å­—ï¼š** æœ¬å®ç°ä»…æ”¯æŒæ‹‰ä¸è½¬å†™ï¼Œä¸å¤„ç†Tengwaræ–‡å­—
5. **æ–¹è¨€å·®å¼‚ï¼š** æ˜†é›…è¯­æœ‰Vanyarinå’ŒNoldorinæ–¹è¨€å·®å¼‚ï¼Œæœ¬å®ç°é‡‡ç”¨æ ‡å‡†Noldorinå‘éŸ³

## æœªæ¥æ‰©å±•

1. **è¾›è¾¾æ—ï¼ˆSindarinï¼‰æ”¯æŒ** - å¦ä¸€ç§ç²¾çµè¯­
2. **Tengwaræ–‡å­—è¾“å…¥** - æ”¯æŒç²¾çµæ–‡å­—ç›´æ¥è¾“å…¥
3. **æ˜†é›…è¯­è¯å…¸** - é›†æˆå¸¸ç”¨è¯æ±‡å’Œç¿»è¯‘
4. **è¯­éŸ³åˆæˆä¼˜åŒ–** - é’ˆå¯¹ç²¾çµè¯­ç‰¹ç‚¹ä¼˜åŒ–å‘éŸ³

---

**å¼€å§‹æ—¶é—´ï¼š** 2025-10-27  
**å®Œæˆæ—¶é—´ï¼š** 2025-10-27  
**çŠ¶æ€ï¼š** âœ… åŸºç¡€åŠŸèƒ½å®Œæˆ  
**ç»´æŠ¤è€…ï¼š** misaki_c_port project

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¼–è¯‘å’Œè¿è¡Œ

```bash
# ç¼–è¯‘
cd misaki_c_port
mkdir -p build && cd build
cmake ..
make demo_quenya

# è¿è¡Œæ¼”ç¤º
./demo_quenya
```

### è¾“å‡ºç¤ºä¾‹

```
=== Quenya (ç²¾çµè¯­) G2P Demo ===

>>> Input: "Quenya"
  Tokens (1): [Quenya] 
    Quenya â†’ IPA: /kw ËˆÉ› nj a/

>>> Input: "Elen sÃ­la lÃºmenn' omentielvo"
  Tokens (4): [Elen] [sÃ­la] [lÃºmenn'] [omentielvo] 
    Elen â†’ IPA: /É› l É› n/
    sÃ­la â†’ IPA: /s ËˆiË l a/
    lÃºmenn' â†’ IPA: /l ËˆuË m É› n n/
    omentielvo â†’ IPA: /É” m É› n t Ëˆi É› l v É”/
```

### C API ä½¿ç”¨

```c
#include "misaki_g2p_qya.h"
#include "misaki_tokenizer_qya.h"

// åˆå§‹åŒ–
misaki_g2p_qya_init();
misaki_tokenizer_qya_init();

// åˆ†è¯
MisakiToken* tokens = NULL;
int token_count = 0;
misaki_tokenize_qya("Elen sÃ­la", &tokens, &token_count);

// G2P è½¬æ¢
for (int i = 0; i < token_count; i++) {
    if (tokens[i].type == TOKEN_WORD) {
        char* phonemes = NULL;
        misaki_g2p_qya_convert(tokens[i].text, &phonemes);
        printf("%s â†’ /%s/\n", tokens[i].text, phonemes);
        free(phonemes);
    }
}

// æ¸…ç†
for (int i = 0; i < token_count; i++) {
    free(tokens[i].text);
}
free(tokens);

misaki_g2p_qya_cleanup();
misaki_tokenizer_qya_cleanup();
```

### æ”¯æŒçš„æ˜†é›…è¯­ç‰¹æ€§

âœ… å…ƒéŸ³ï¼ša, e, i, o, u  
âœ… é•¿å…ƒéŸ³ï¼šÃ¡, Ã©, Ã­, Ã³, Ãº  
âœ… åŒå…ƒéŸ³ï¼šai, au, iu, eu, oi, ui  
âœ… ç‰¹æ®Šå­—ç¬¦ï¼šÃ±, Ã¾, Ã«  
âœ… è¾…éŸ³ç°‡ï¼šqu, ng, th, hl, hr, hw  
âœ… è…­éŸ³åŒ–ï¼šty, ny, ly, ry, sy  
âœ… é‡éŸ³æ ‡è®°ï¼ˆåŸºæœ¬è§„åˆ™ï¼‰  
âœ… UTF-8 ç¼–ç æ”¯æŒ  

### å·²æµ‹è¯•è¯æ±‡

- **Quenya** /kw ËˆÉ› nj a/ - æ˜†é›…è¯­
- **Eldar** /É› l d a r/ - ç²¾çµ
- **Valar** /v Ëˆa l a r/ - ç»´æ‹‰
- **Elen sÃ­la lÃºmenn' omentielvo** - æ˜Ÿå…‰ç…§è€€æˆ‘ä»¬ç›¸é‡ä¹‹æ—¶
- **NamÃ¡riÃ«** /n a m ËˆaË r i É›/ - å‘Šåˆ«
- **Arda** /a r d a/ - ä¸–ç•Œ
- **IlÃºvatar** /i l ËˆuË v a t a r/ - è‡³é«˜ç¥
