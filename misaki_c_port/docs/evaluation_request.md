# 日文分词器评测请求

## 背景说明

这是一个从零开始实现的**轻量级日文分词器**（C 语言），用于 TTS（文本转语音）应用。目标是在**无 MeCab 依赖**的情况下，实现尽可能准确的日文分词和音素转换。

## 技术特点

- ✅ **零外部依赖**：不依赖 MeCab，完全自主实现
- ✅ **轻量级**：适合移动端和嵌入式设备
- ✅ **Viterbi 算法**：动态规划求最优分词路径
- ✅ **词性转移规则**：9 条硬编码规则改善分词质量
- ✅ **词典支持**：68,272 个词汇（含读音标注）

## 优化措施

1. **参数调优**
   - 长度奖励：15.0（鼓励选择长词）
   - 单字惩罚：30.0（避免过度拆分）

2. **词性转移规则**（9 条）
   - 動詞 + 助動詞：-10.0（强制结合，如：なり + たい）
   - 助動詞 + 助動詞：-12.0（最强鼓励，如：い + まし + た）
   - 形容詞 + 名詞：-4.0（鼓励结合，如：新しい + カフェ）
   - 名詞 + 名詞：+3.0（惩罚过度复合）

3. **补充词典**（+185 词）
   - 复合名词：宇宙飛行士、久しぶり 等
   - 动词活用：会って、思って、食べながら 等
   - 形容词：美味しい、楽しい 等
   - 常用短语：ありがとう、お疲れさま 等

## 测试结果

### 测试 1：简单句子 ✅
```
输入：私は学生です
结果：4 tokens
  私 (代名詞) → は (助詞) → 学生 (名詞) → です (助動詞)
音素：βatakɯɕi βa ɡakɯseː desɨ
```

**评价点**：
- 是否正确识别了词边界？
- 助词"は"是否单独成词？（正确）
- 复合名词"学生"是否完整？（正确）

---

### 测试 2：复杂长句 ⚠️
```
输入：昨日、新しいカフェで友達と久しぶりに会って、美味しいケーキを食べながら二時間も喋りました。
结果：25 tokens

关键词分词：
  ✅ 昨日 (完整)
  ✅ 新しい (形容詞，完整)
  ✅ カフェ (外来语，完整)
  ✅ 友達 (复合名词，完整) 
  ⚠️ 久しぶり → 久 + しぶり (部分拆分)
  ⚠️ 会って → 会 + って (动词活用被拆分)
  ✅ 美味しい (形容詞，完整)
  ✅ ケーキ (外来语，完整)
  ⚠️ 食べながら → 食べ + ながら (部分拆分)
  ✅ 二時間 (完整)
  ✅ 喋りました → 喋り + まし + た (助动词正确组合)
```

**音素输出**：
```
kʲinoː , ataɾaɕiː kaɸɯe de tomodaʨi to çisaɕi ɕibɯɾʲi ɲi kai ʔte , 
oiɕiː keːkʲi o tabe naɡaɾa ɲi ʥikaɴ mo ɕijabeɾʲi maɕi ta .
```

**重点评价问题**：
1. **形容词处理**："新しい"、"美味しい"是否应该保持完整？（当前：✅ 完整）
2. **动词活用**："会って"被拆成"会 + って"，对 TTS 音调影响大吗？
3. **复合名词**："友達"完整识别，"久しぶり"部分拆分，是否可接受？
4. **助动词组合**："喋り + まし + た"的分词方式对读音影响如何？
5. **总体评价**：25 个 token，是否合理？（MeCab 可能是 18-20 个）

---

### 测试 3：中等句子 ⚠️
```
输入：子供の頃、宇宙飛行士になりたいと思っていました。
结果：17 tokens

关键词分词：
  ✅ 子供 (复合名词，完整)
  ✅ 頃 (完整)
  ⚠️ 宇宙飛行士 → 宇宙 + 飛行 + 士 (复合名词被拆分)
  ⚠️ なりたい → な + り + たい (助动词识别，但分散)
  ⚠️ 思っていました → 思っ + てい + まし + た (动词活用被拆分)
```

**重点评价问题**：
1. **复合名词缺失**："宇宙飛行士"应该是一个词，被拆成 3 个，影响严重吗？
2. **动词活用**："思って"的"って"被单独处理，是否会导致音调错误？
3. **助动词分散**："な + り + たい"vs"なりたい"，哪种对 TTS 更友好？

---

### 测试 4：常用短语 ⚠️
```
输入：ありがとうございます。お疲れさまでした。
结果：14 tokens

关键词分词：
  ⚠️ ありがとうございます → あ + り + が + とう + ござい + ます (严重拆分)
  ⚠️ お疲れさまでした → お + 疲れ + さ + ま + でし + た (严重拆分)
```

**重点评价问题**：
1. **固定短语识别**：这些是固定的礼貌用语，应该作为整体吗？
2. **对 TTS 的影响**：拆分后的音素序列能否正确合成？
3. **实用性**：这种拆分在实际应用中可接受吗？

---

### 测试 5：日常对话 ⚠️
```
输入：今日は天気がいいですね。公園で散歩しませんか。
结果：17 tokens

关键词分词：
  ✅ 今日 (完整)
  ✅ 天気 (完整)
  ✅ いい (形容詞，完整)
  ✅ です (助動詞，完整)
  ✅ 公園 (完整)
  ✅ 散歩 (完整)
  ⚠️ しませんか → し + ま + せ + ん + か (助动词否定疑问形被拆分)
```

---

## 请您评价的核心问题

### 1. 对于 TTS 应用的适用性 ⭐⭐⭐⭐⭐
**问题**：
- 这种分词方式是否会对**音调**和**韵律**产生严重影响？
- 动词活用被拆分（如"会って" → "会 + って"）是否会导致**发音错误**？
- 助动词组合（如"まし + た"）能否正确表达**时态**？

### 2. 与 MeCab 的差距评估 ⭐⭐⭐⭐
**对比维度**：
- **准确性**：MeCab 可能达到 95%，本系统约 70-80%，差距可接受吗？
- **实用性**：对于 TTS 应用，是否"够用就好"？
- **性能**：本系统更轻量，是否值得牺牲一些准确性？

### 3. 改进建议 ⭐⭐⭐⭐⭐
**最需要改进的地方**（按优先级排序）：
1. 动词活用识别？（如：会って、食べながら）
2. 固定短语识别？（如：ありがとうございます）
3. 复合名词补充？（如：宇宙飛行士）
4. 助动词组合规则？（如：しませんか）
5. 其他？

### 4. 总体评分 ⭐⭐⭐⭐⭐
请给出以下维度的评分（满分 5 星）：
- **分词准确性**: ？/5
- **TTS 适用性**: ？/5
- **技术实现质量**: ？/5
- **实际应用价值**: ？/5
- **综合评分**: ？/5

---

## 补充信息

### 已知限制
1. **词典覆盖有限**：68K 词 vs MeCab 的 70 万词
2. **无活用规则**：无法自动识别动词变形
3. **无词性转移矩阵**：只有 9 条硬编码规则

### 设计目标
1. ✅ **轻量级**：适合移动端
2. ✅ **零依赖**：不需要 MeCab
3. ✅ **够用就好**：不追求 100% 准确

### 对比基准
- **MeCab**：业界标准，但体积大、依赖多
- **本系统**：自主实现，牺牲 10-20% 准确性换取轻量化

---

## 如何运行测试

```bash
cd /mnt/e/development/kokoro-ja-demo/misaki_c_port/build
./misaki "测试文本"
```

或运行完整演示：
```bash
wsl bash /mnt/e/development/kokoro-ja-demo/misaki_c_port/demo_tokenizer.sh
```

---

## 期待的评价内容

请从以下角度进行评价：

1. **语言学角度**：分词是否符合日语语法规则？
2. **TTS 应用角度**：这种分词是否会影响语音合成的自然度？
3. **工程实践角度**：在资源受限的环境下，这种实现是否合理？
4. **改进建议**：最值得优化的 3 个方向是什么？

感谢您的专业评价！🙏
